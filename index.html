<!DOCTYPE html>
<html lang="en" class="antialiased scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Global Pulse | Multilingual Voice-Enabled News</title>
    <meta name="description" content="A premium, voice-enabled news aggregator featuring calm, natural text-to-speech in English, Hindi, and Telugu.">
    
    <!-- Fonts: Inter for UI, Noto Sans for multilingual support (Devanagari & Telugu) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500&family=Noto+Sans+Telugu:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans Devanagari', 'Noto Sans Telugu', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            gold: '#D4AF37', // Royal Gold
                            darkGold: '#B4941F', // Darker Royal Gold shade
                        },
                        light: {
                            bg: '#CFFAFE',   // Cyan 100 - Aqua Crystal Base
                            card: '#FFFFFF', // Pure White for clean contrast
                            border: '#67E8F9', // Cyan 300 - Crystal Edge
                            text: '#0F172A', // Slate 900 for sharp readability
                        },
                        dark: {
                            bg: '#121212',   // Greyish Black Base
                            card: '#1A1A1A', // Dark Charcoal
                            border: '#333333',
                            text: '#F5F5F5', // Off-White
                            subtext: '#A1A1A1'
                        }
                    },
                    animation: {
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'slide-down': 'slideDown 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'fade-in-down': 'fadeInDown 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(0)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for Categories */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Smooth image loading fade-in */
        .img-fade-in {
            opacity: 0;
            transition: opacity 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .img-loaded {
            opacity: 1;
        }

        /* Line clamping for cleaner cards */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<!-- Updated Body: Aqua Blue Crystal Shiny Gradient (Light) | Deep Space Blue Night Gradient (Dark) -->
<body class="bg-[radial-gradient(circle_at_top_left,_var(--tw-gradient-stops))] from-white via-cyan-200 to-sky-300 text-light-text dark:bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] dark:from-[#172554] dark:via-[#020617] dark:to-black dark:text-dark-text transition-colors duration-700 min-h-screen flex flex-col font-medium dark:font-normal bg-fixed selection:bg-brand-gold selection:text-black">

    <!-- Navbar -->
    <!-- Updated with animate-fade-in-down for smooth entry -->
    <header class="animate-fade-in-down sticky top-0 z-50 bg-cyan-50/30 dark:bg-slate-900/30 backdrop-blur-3xl backdrop-saturate-200 border-b border-cyan-100/30 dark:border-slate-700/30 shadow-lg shadow-cyan-500/10 transition-all duration-500 ease-out">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <!-- Logo - Made Extra Interactive -->
            <div class="flex items-center gap-2 sm:gap-3 group cursor-pointer select-none" onclick="App.resetHome()">
                <div class="relative w-8 h-8 sm:w-9 sm:h-9 shrink-0">
                    <div class="absolute inset-0 bg-brand-gold rounded-xl rotate-3 group-hover:rotate-12 transition-transform duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) opacity-20"></div>
                    <div class="absolute inset-0 bg-brand-gold rounded-xl -rotate-3 group-hover:-rotate-12 transition-transform duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) opacity-20"></div>
                    <div class="relative w-full h-full rounded-xl bg-brand-gold flex items-center justify-center text-dark-bg font-bold shadow-lg shadow-brand-gold/20 transform group-hover:scale-110 group-active:scale-95 transition-all duration-300 cubic-bezier(0.34, 1.56, 0.64, 1)">
                        GP
                    </div>
                </div>
                <!-- Text Hidden on extremely small screens if needed, but text-lg fits most -->
                <h1 class="text-lg sm:text-xl font-bold tracking-tight text-gray-800 dark:text-white group-hover:tracking-wide transition-all duration-300 truncate">
                    Global <span class="text-brand-darkGold dark:text-brand-gold relative inline-block group-hover:-translate-y-0.5 group-hover:rotate-2 transition-transform duration-300">Pulse</span>
                </h1>
            </div>

            <!-- Search & Actions -->
            <div class="flex items-center gap-2 sm:gap-4">
                <!-- Search Bar (Desktop) - Expands on Focus -->
                <div class="hidden md:flex relative group">
                    <div class="absolute inset-0 bg-blue-400/20 rounded-full blur-md opacity-0 group-hover:opacity-100 transition-all duration-500 pointer-events-none scale-90 group-hover:scale-110"></div>
                    <input type="text" 
                           id="searchInput" 
                           placeholder="Search news..." 
                           class="relative z-10 w-64 focus:w-72 bg-white/40 dark:bg-slate-800/40 border border-blue-100/50 dark:border-slate-700/50 rounded-full py-2.5 pl-11 pr-4 text-sm text-gray-800 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:bg-white/80 dark:focus:bg-slate-900/80 focus:border-blue-300 focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900/30 transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) backdrop-blur-md shadow-sm group-hover:shadow-md">
                    <i data-lucide="search" class="absolute left-3.5 top-2.5 w-4 h-4 text-gray-500 group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors z-20"></i>
                </div>

                <!-- Language Selector -->
                <div class="relative group">
                    <select id="languageSelect" onchange="App.switchLanguage(this.value)" class="appearance-none bg-white/40 dark:bg-slate-800/40 border border-blue-100/50 dark:border-slate-700/50 rounded-full py-2 sm:py-2.5 pl-3 sm:pl-4 pr-8 sm:pr-9 text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-brand-gold/50 cursor-pointer hover:bg-white/60 dark:hover:bg-slate-700/50 transition-all shadow-sm backdrop-blur-md">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="te">Telugu</option>
                    </select>
                    <i data-lucide="globe" class="absolute right-2.5 sm:right-3 top-2.5 w-3.5 h-3.5 sm:w-4 sm:h-4 text-gray-500 pointer-events-none group-hover:text-brand-darkGold dark:group-hover:text-brand-gold transition-colors"></i>
                </div>

                <!-- Voice Gender Toggle (NEW) -->
                <button id="voiceToggle" onclick="App.toggleVoiceGender()" class="relative p-2 sm:p-2.5 bg-white/40 dark:bg-slate-800/40 border border-blue-100/50 dark:border-slate-700/50 rounded-full text-gray-700 dark:text-gray-200 hover:bg-white/60 dark:hover:bg-slate-700/50 transition-all shadow-sm backdrop-blur-md group active:scale-95" aria-label="Toggle Voice Gender">
                    <span id="voiceIcon" class="text-base sm:text-lg leading-none filter drop-shadow-sm">ðŸ‘©</span>
                    <!-- Tooltip (Desktop Only) -->
                    <span class="hidden md:block absolute -bottom-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/80 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                        Change Voice
                    </span>
                </button>

                <!-- Search Icon (Mobile) -->
                <button class="md:hidden p-2 sm:p-2.5 hover:bg-blue-100/30 dark:hover:bg-slate-800/30 rounded-full text-gray-600 dark:text-gray-300 transition-all active:scale-90" onclick="document.getElementById('mobileSearch').classList.toggle('hidden')">
                    <i data-lucide="search" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                </button>

                <!-- Theme Toggle - Spinny & Friendly -->
                <button id="themeToggle" class="relative p-2 sm:p-2.5 rounded-full overflow-hidden group transition-all duration-300 hover:bg-blue-100/30 dark:hover:bg-slate-800/30 hover:shadow-lg active:scale-90 hover:rotate-12" aria-label="Toggle Theme">
                    <div class="relative z-10 group-hover:rotate-[45deg] transition-transform duration-500 cubic-bezier(0.34, 1.56, 0.64, 1)">
                        <!-- Moon (Dark Mode) - Super Enhanced Glow -->
                        <i data-lucide="moon" class="w-4 h-4 sm:w-5 sm:h-5 hidden dark:block text-brand-gold drop-shadow-[0_0_25px_rgba(255,215,0,1)] filter"></i>
                        <!-- Sun (Light Mode) - Intense Glow -->
                        <i data-lucide="sun" class="w-4 h-4 sm:w-5 sm:h-5 block dark:hidden text-brand-darkGold drop-shadow-[0_0_20px_rgba(234,179,8,1)] filter"></i>
                    </div>
                </button>
            </div>
        </div>

        <!-- Mobile Search Bar (Collapsible) -->
        <div id="mobileSearch" class="hidden px-4 pb-4 md:hidden border-t border-blue-100/30 dark:border-slate-700/30 bg-blue-50/80 dark:bg-slate-900/80 backdrop-blur-3xl animate-slide-down">
            <div class="relative mt-4 group">
                <input type="text" 
                       id="mobileSearchInput" 
                       placeholder="Search global news..." 
                       class="w-full bg-white/40 dark:bg-slate-800/40 border border-blue-100/50 dark:border-slate-700/50 rounded-xl py-3 pl-11 pr-4 text-base text-gray-800 dark:text-gray-200 placeholder-gray-500 focus:outline-none focus:bg-white/80 dark:focus:bg-slate-900/80 focus:border-blue-300 focus:ring-4 focus:ring-blue-100 dark:focus:ring-blue-900/30 transition-all duration-300 backdrop-blur-md">
                <i data-lucide="search" class="absolute left-3.5 top-3.5 w-5 h-5 text-gray-500 z-20"></i>
            </div>
        </div>

        <!-- Categories Nav - Floating & Interactive -->
        <nav class="border-t border-blue-100/20 dark:border-slate-700/20 overflow-x-auto hide-scrollbar bg-transparent py-2">
            <div class="max-w-7xl mx-auto px-4 flex gap-2 sm:gap-3 py-1 min-w-max pr-4" id="categoryContainer">
                <!-- Categories injected by JS -->
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <!-- Added pb-32 to accommodate floating player on mobile -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full pb-32">
        
        <!-- Status Banner (Network/API errors) -->
        <!-- Added animate-fade-in-down -->
        <div id="statusBanner" class="hidden animate-fade-in-down mb-6 p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 text-sm flex items-center gap-3 border border-blue-100 dark:border-blue-800 shadow-sm backdrop-blur-sm">
            <i data-lucide="info" class="w-4 h-4 shrink-0 animate-pulse-slow"></i>
            <span id="statusText">Initializing...</span>
        </div>

        <!-- News Grid -->
        <div id="newsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards injected by JS -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 text-center animate-fade-in-up">
            <div class="w-16 h-16 bg-gray-100 dark:bg-white/5 rounded-full flex items-center justify-center mb-4 animate-float">
                <i data-lucide="newspaper" class="w-8 h-8 text-gray-400"></i>
            </div>
            <h3 class="text-lg font-semibold mb-2">No stories found</h3>
            <p class="text-gray-500 dark:text-gray-400 max-w-xs">Try adjusting your search or category filters.</p>
        </div>
    </main>

    <!-- Audio Player (Sticky Bottom / Floating) -->
    <!-- Updated to float nicely on all screens -->
    <div id="audioPlayer" class="fixed bottom-4 left-0 right-0 mx-4 sm:mx-auto max-w-3xl transform translate-y-[150%] transition-transform duration-500 cubic-bezier(0.175, 0.885, 0.32, 1.275) z-50">
        <div class="bg-light-card/95 dark:bg-[#1F1F1F]/95 backdrop-blur-xl border border-light-border dark:border-[#333] shadow-2xl rounded-2xl p-3 sm:p-4 flex items-center gap-3 sm:gap-6">
            
            <!-- Status Icon -->
            <div class="relative shrink-0">
                <div id="speakingIndicator" class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-brand-gold/10 flex items-center justify-center text-brand-darkGold dark:text-brand-gold">
                    <i data-lucide="mic" class="w-5 h-5 sm:w-6 sm:h-6"></i>
                </div>
                <!-- Ripple animation when playing -->
                <div id="speakingRipple" class="absolute inset-0 rounded-full border-2 border-brand-gold opacity-0"></div>
            </div>

            <!-- Info -->
            <div class="flex-1 min-w-0">
                <p class="text-[10px] sm:text-xs uppercase tracking-wider font-bold text-brand-darkGold dark:text-brand-gold mb-0.5 sm:mb-1" id="playerLabel">Reading Article</p>
                <h4 class="text-sm sm:text-base font-semibold truncate text-light-text dark:text-white" id="playerTitle">Select an article to listen</h4>
                <p class="text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5" id="playerSource">Global Pulse AI</p>
            </div>

            <!-- Controls -->
            <div class="flex items-center gap-2 sm:gap-4 shrink-0">
                <button id="btnStop" class="p-2 hover:bg-gray-100 dark:hover:bg-white/10 rounded-full transition-colors text-gray-500 dark:text-gray-400 active:scale-95" aria-label="Stop">
                    <i data-lucide="square" class="w-4 h-4 sm:w-5 sm:h-5 fill-current"></i>
                </button>
                <button id="btnPlayPause" class="w-10 h-10 sm:w-12 sm:h-12 flex items-center justify-center bg-brand-gold hover:bg-brand-darkGold text-dark-bg rounded-full shadow-lg transition-transform hover:scale-105 active:scale-95" aria-label="Play/Pause">
                    <i data-lucide="pause" class="w-5 h-5 sm:w-6 sm:h-6 fill-current" id="iconPlayPause"></i>
                </button>
                <!-- Close button visible on all screens now for usability -->
                <button id="btnClosePlayer" class="p-2 hover:bg-gray-100 dark:hover:bg-white/10 rounded-full transition-colors text-gray-400 active:scale-95" aria-label="Close">
                    <i data-lucide="x" class="w-4 h-4 sm:w-5 sm:h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        /**
         * GLOBAL PULSE CONFIGURATION
         */
        const CONFIG = {
            // Replace with your actual GNews API key (https://gnews.io/)
            // If left as default, the app will gracefully fallback to sample data.
            apiKey: 'Add_Your_GNEWS_API_Key_Here', 
            
            categories: ['General', 'World', 'Technology', 'Business', 'Science', 'Health', 'Entertainment', 'Sports'],
            fallbackImages: [
                'https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&q=80&w=800',
                'https://images.unsplash.com/photo-1495020689067-958852a7765e?auto=format&fit=crop&q=80&w=800',
                'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?auto=format&fit=crop&q=80&w=800'
            ],
            // Multilingual Mock Data (High quality fallback)
            mockData: [
                {
                    title: "SpaceX Successfully Launches Next-Gen Starship",
                    description: "The massive rocket achieved orbit for the first time, marking a major milestone in human space exploration efforts.",
                    content: "SpaceX has successfully launched its massive Starship rocket, achieving orbit for the first time. This marks a pivotal moment in the company's ambition to make life multi-planetary. The launch took place at the Starbase facility in Texas. Thousands of spectators gathered to witness the historic event. Elon Musk stated that this is just the beginning of a new era.",
                    url: "#",
                    image: "https://images.unsplash.com/photo-1517976487492-5750f3195933?auto=format&fit=crop&q=80&w=800",
                    publishedAt: new Date().toISOString(),
                    source: { name: "TechCrunch" },
                    lang: "en"
                },
                {
                    title: "Global Markets Rally as Inflation Cools",
                    description: "Major indices hit record highs today as fresh data suggests the global economy is stabilizing faster than expected.",
                    content: "Stock markets across Asia, Europe, and the Americas rallied today following reports of cooling inflation. The S&P 500 reached a new all-time high. Economists suggest that central bank policies are finally taking effect without causing a recession. Investors remain optimistic about the coming quarter.",
                    url: "#",
                    image: "https://images.unsplash.com/photo-1611974765270-ca1258634369?auto=format&fit=crop&q=80&w=800",
                    publishedAt: new Date().toISOString(),
                    source: { name: "Bloomberg" },
                    lang: "en"
                },
                {
                    title: "à°­à°¾à°°à°¤ à°…à°‚à°¤à°°à°¿à°•à±à°· à°ªà°°à°¿à°¶à±‹à°§à°¨à°²à±‹ à°•à±Šà°¤à±à°¤ à°…à°§à±à°¯à°¾à°¯à°‚", // Telugu
                    description: "à°‡à°¸à±à°°à±‹ à°ªà±à°°à°¯à±‹à°—à°¿à°‚à°šà°¿à°¨ à°¤à°¾à°œà°¾ à°‰à°ªà°—à±à°°à°¹à°‚ à°µà°¿à°œà°¯à°µà°‚à°¤à°‚à°—à°¾ à°•à°•à±à°·à±à°¯à°²à±‹à°•à°¿ à°šà±‡à°°à°¿à°‚à°¦à°¿. à°‡à°¦à°¿ à°•à°®à±à°¯à±‚à°¨à°¿à°•à±‡à°·à°¨à± à°µà±à°¯à°µà°¸à±à°¥à°¨à± à°®à°°à°¿à°‚à°¤ à°¬à°²à±‹à°ªà±‡à°¤à°‚ à°šà±‡à°¸à±à°¤à±à°‚à°¦à°¿.",
                    content: "à°­à°¾à°°à°¤ à°…à°‚à°¤à°°à°¿à°•à±à°· à°ªà°°à°¿à°¶à±‹à°§à°¨ à°¸à°‚à°¸à±à°¥ (à°‡à°¸à±à°°à±‹) à°®à°°à±‹ à°˜à°¨à°µà°¿à°œà°¯à°¾à°¨à±à°¨à°¿ à°¸à°¾à°§à°¿à°‚à°šà°¿à°‚à°¦à°¿. à°¨à°¿à°¨à±à°¨ à°ªà±à°°à°¯à±‹à°—à°¿à°‚à°šà°¿à°¨ à°…à°§à±à°¨à°¾à°¤à°¨ à°•à°®à±à°¯à±‚à°¨à°¿à°•à±‡à°·à°¨à± à°‰à°ªà°—à±à°°à°¹à°‚ à°µà°¿à°œà°¯à°µà°‚à°¤à°‚à°—à°¾ à°•à°•à±à°·à±à°¯à°²à±‹à°•à°¿ à°ªà±à°°à°µà±‡à°¶à°¿à°‚à°šà°¿à°‚à°¦à°¿. à°¦à±€à°¨à°¿à°µà°²à±à°² à°—à±à°°à°¾à°®à±€à°£ à°ªà±à°°à°¾à°‚à°¤à°¾à°²à±à°²à±‹ à°‡à°‚à°Ÿà°°à±à°¨à±†à°Ÿà± à°¸à±‡à°µà°²à± à°®à±†à°°à±à°—à±à°ªà°¡à°¤à°¾à°¯à°¨à°¿ à°¶à°¾à°¸à±à°¤à±à°°à°µà±‡à°¤à±à°¤à°²à± à°¤à±†à°²à°¿à°ªà°¾à°°à±.",
                    url: "#",
                    image: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=800",
                    publishedAt: new Date().toISOString(),
                    source: { name: "Eenadu" },
                    lang: "te"
                },
                {
                    title: "à¤¨à¤µà¥€à¤•à¤°à¤£à¥€à¤¯ à¤Šà¤°à¥à¤œà¤¾ à¤®à¥‡à¤‚ à¤­à¤¾à¤°à¤¤ à¤•à¥€ à¤¬à¤¡à¤¼à¥€ à¤›à¤²à¤¾à¤‚à¤—", // Hindi
                    description: "à¤¸à¥Œà¤° à¤Šà¤°à¥à¤œà¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦à¤¨ à¤®à¥‡à¤‚ à¤¦à¥‡à¤¶ à¤¨à¥‡ à¤¨à¤¯à¤¾ à¤°à¤¿à¤•à¥‰à¤°à¥à¤¡ à¤¬à¤¨à¤¾à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤¸à¤°à¤•à¤¾à¤° à¤¨à¥‡ à¤¹à¤°à¤¿à¤¤ à¤Šà¤°à¥à¤œà¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤¨à¤ˆ à¤¨à¥€à¤¤à¤¿à¤¯à¥‹à¤‚ à¤•à¥€ à¤˜à¥‹à¤·à¤£à¤¾ à¤•à¥€ à¤¹à¥ˆà¥¤",
                    content: "à¤­à¤¾à¤°à¤¤ à¤¨à¥‡ à¤¨à¤µà¥€à¤•à¤°à¤£à¥€à¤¯ à¤Šà¤°à¥à¤œà¤¾ à¤•à¥‡ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤®à¥‡à¤‚ à¤à¤• à¤”à¤° à¤®à¤¹à¤¤à¥à¤µà¤ªà¥‚à¤°à¥à¤£ à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¿ à¤¹à¤¾à¤¸à¤¿à¤² à¤•à¥€ à¤¹à¥ˆà¥¤ à¤¸à¥Œà¤° à¤Šà¤°à¥à¤œà¤¾ à¤‰à¤¤à¥à¤ªà¤¾à¤¦à¤¨ à¤•à¥à¤·à¤®à¤¤à¤¾ à¤®à¥‡à¤‚ 20% à¤•à¥€ à¤µà¥ƒà¤¦à¥à¤§à¤¿ à¤¦à¤°à¥à¤œ à¤•à¥€ à¤—à¤ˆ à¤¹à¥ˆà¥¤ à¤ªà¥à¤°à¤§à¤¾à¤¨à¤®à¤‚à¤¤à¥à¤°à¥€ à¤¨à¥‡ à¤•à¤¹à¤¾ à¤•à¤¿ à¤¹à¤® à¤¸à¤¤à¤¤ à¤µà¤¿à¤•à¤¾à¤¸ à¤•à¥‡ à¤²à¤•à¥à¤·à¥à¤¯à¥‹à¤‚ à¤•à¥‹ à¤¸à¤®à¤¯ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¥‡à¤‚à¤—à¥‡à¥¤ à¤¯à¤¹ à¤ªà¤°à¥à¤¯à¤¾à¤µà¤°à¤£ à¤¸à¤‚à¤°à¤•à¥à¤·à¤£ à¤•à¥€ à¤¦à¤¿à¤¶à¤¾ à¤®à¥‡à¤‚ à¤à¤• à¤¬à¤¡à¤¼à¤¾ à¤•à¤¦à¤® à¤¹à¥ˆà¥¤",
                    url: "#",
                    image: "https://images.unsplash.com/photo-1509391366360-2e959784a276?auto=format&fit=crop&q=80&w=800",
                    publishedAt: new Date().toISOString(),
                    source: { name: "Dainik Jagran" },
                    lang: "hi"
                },
                {
                    title: "The Future of AI in Healthcare",
                    description: "Doctors are increasingly using artificial intelligence to diagnose rare diseases with unprecedented accuracy.",
                    content: "Artificial Intelligence is revolutionizing modern medicine. New algorithms can detect patterns in X-rays that human eyes often miss. Hospitals in London and New York have started pilot programs using these tools. While ethical concerns remain, the potential to save lives is undeniable.",
                    url: "#",
                    image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&q=80&w=800",
                    publishedAt: new Date().toISOString(),
                    source: { name: "Science Daily" },
                    lang: "en"
                }
            ]
        };

        /**
         * STATE MANAGEMENT
         */
        const State = {
            articles: [],
            currentCategory: 'General',
            searchQuery: '',
            isLoading: false,
            language: 'en', // Default Language
            voiceGender: 'female', // Default Voice Gender ('male' or 'female')
            theme: localStorage.getItem('theme') || 'system',
            tts: {
                speaking: false,
                paused: false,
                currentText: '',
                utterance: null
            }
        };

        /**
         * TTS ENGINE (Text-to-Speech)
         */
        const TTSEngine = {
            voices: [],
            
            init() {
                // Load voices (async nature of speech API)
                const loadVoices = () => {
                    this.voices = window.speechSynthesis.getVoices();
                };
                window.speechSynthesis.onvoiceschanged = loadVoices;
                loadVoices();
            },

            ensureVoices() {
                 if (this.voices.length === 0) {
                     this.voices = window.speechSynthesis.getVoices();
                 }
            },

            getBestVoice(langCode, genderPreference = 'female') {
                this.ensureVoices();
                
                // Map to proper IETF BCP 47 language tags
                const targetCode = langCode === 'hi' ? 'hi-IN' : 
                                   langCode === 'te' ? 'te-IN' : 
                                   'en-US';

                // Helper to normalize voice tags
                const normalize = (tag) => tag.replace('_', '-');

                // 1. Filter by Language first
                const langVoices = this.voices.filter(v => 
                    normalize(v.lang) === targetCode || 
                    normalize(v.lang).startsWith(langCode)
                );

                if (langVoices.length === 0) {
                    // Fallback to English if target lang not found
                    return this.voices.find(v => normalize(v.lang).startsWith('en')) || this.voices[0];
                }

                // 2. Filter by Gender Preference using Name Heuristics
                // Note: 'Google' voices usually default to female-sounding unless specified otherwise
                const isMale = (name) => {
                    const n = name.toLowerCase();
                    return n.includes('male') || n.includes('david') || n.includes('rishi') || n.includes('mark') || n.includes('ivan') || n.includes('daniel');
                };

                const isFemale = (name) => {
                    const n = name.toLowerCase();
                    return n.includes('female') || n.includes('zira') || n.includes('samantha') || n.includes('google');
                };

                let bestMatch;

                if (genderPreference === 'male') {
                    // Try to find explicit male voice
                    bestMatch = langVoices.find(v => isMale(v.name));
                    // If no male voice, try to avoid explicit female voices if possible
                    if (!bestMatch) bestMatch = langVoices.find(v => !isFemale(v.name));
                } else {
                    // Female preference
                    bestMatch = langVoices.find(v => isFemale(v.name));
                    // If no explicit female, pick anything that isn't explicitly male
                    if (!bestMatch) bestMatch = langVoices.find(v => !isMale(v.name));
                }

                return bestMatch || langVoices[0];
            },

            speak(text, lang = 'en', gender = 'female', onStart, onEnd) {
                // 1. Validate Input
                if (!text) return;

                // 2. Stop any existing speech strictly
                window.speechSynthesis.cancel();
                State.tts.speaking = false;

                // 3. Small delay to allow cancellation to take effect
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // CRITICAL: Explicitly set the language
                    utterance.lang = lang === 'hi' ? 'hi-IN' : 
                                     lang === 'te' ? 'te-IN' : 
                                     'en-US';

                    // 4. Try to find a specific voice object based on Language AND Gender
                    const voice = this.getBestVoice(lang, gender);
                    if (voice) {
                        utterance.voice = voice;
                        
                        // [HOTFIX] Check for Voice Mismatch
                        const requestedLang = lang.toLowerCase(); 
                        const actualVoiceLang = voice.lang.replace('_', '-').toLowerCase();

                        if (requestedLang !== 'en' && !actualVoiceLang.startsWith(requestedLang)) {
                             const langName = requestedLang === 'hi' ? 'Hindi' : 'Telugu';
                             UI.showBanner(`âš ï¸ ${langName} voice unavailable. Using system fallback.`);
                        }
                    }

                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;

                    utterance.onstart = () => {
                        State.tts.speaking = true;
                        State.tts.paused = false;
                        State.tts.utterance = utterance; // Keep reference to prevent GC
                        if(onStart) onStart();
                    };

                    utterance.onend = () => {
                        State.tts.speaking = false;
                        State.tts.paused = false;
                        State.tts.utterance = null;
                        if(onEnd) onEnd();
                    };

                    utterance.onerror = (e) => {
                        if (e.error === 'interrupted' || e.error === 'canceled') {
                            State.tts.speaking = false;
                            return;
                        }
                        console.error("TTS Error Details:", e.error);
                        State.tts.speaking = false;
                    };

                    window.speechSynthesis.speak(utterance);
                }, 10);
            },

            pause() {
                if (window.speechSynthesis.speaking && !window.speechSynthesis.paused) {
                    window.speechSynthesis.pause();
                    State.tts.paused = true;
                }
            },

            resume() {
                if (window.speechSynthesis.paused) {
                    window.speechSynthesis.resume();
                    State.tts.paused = false;
                }
            },

            stop() {
                window.speechSynthesis.cancel();
                State.tts.speaking = false;
                State.tts.paused = false;
                State.tts.utterance = null;
            }
        };

        /**
         * UI RENDERER
         */
        const UI = {
            els: {
                grid: document.getElementById('newsGrid'),
                categories: document.getElementById('categoryContainer'),
                player: document.getElementById('audioPlayer'),
                statusBanner: document.getElementById('statusBanner'),
                statusText: document.getElementById('statusText'),
                searchInput: document.getElementById('searchInput'),
                mobileSearchInput: document.getElementById('mobileSearchInput'),
                languageSelect: document.getElementById('languageSelect'),
                voiceIcon: document.getElementById('voiceIcon'), // NEW
                playerTitle: document.getElementById('playerTitle'),
                playerSource: document.getElementById('playerSource'),
                btnPlayPause: document.getElementById('btnPlayPause'),
                iconPlayPause: document.getElementById('iconPlayPause'),
                btnStop: document.getElementById('btnStop'),
                btnClosePlayer: document.getElementById('btnClosePlayer'),
                speakingRipple: document.getElementById('speakingRipple'),
                emptyState: document.getElementById('emptyState')
            },

            initIcons() {
                lucide.createIcons();
            },

            renderCategories() {
                // Friendly, Pill-shaped, Bouncy Categories
                this.els.categories.innerHTML = CONFIG.categories.map(cat => `
                    <button 
                        onclick="App.switchCategory('${cat}')"
                        class="relative px-5 py-2 rounded-full text-sm font-medium transition-all duration-300 ease-out whitespace-nowrap z-10 select-none
                        ${State.currentCategory === cat 
                            ? 'bg-brand-gold text-dark-bg shadow-lg shadow-brand-gold/40 scale-105 ring-2 ring-white/20 dark:ring-black/20 font-bold translate-y-[-1px]' 
                            : 'bg-white/30 dark:bg-white/5 text-gray-600 dark:text-gray-300 hover:bg-white/60 dark:hover:bg-white/10 hover:text-brand-darkGold dark:hover:text-brand-gold hover:shadow-md hover:-translate-y-0.5'
                        } active:scale-95 active:shadow-sm active:translate-y-0">
                        ${cat}
                    </button>
                `).join('');
            },

            renderSkeleton() {
                this.els.grid.innerHTML = Array(6).fill(0).map((_, i) => `
                    <div style="animation-delay: ${i * 100}ms" class="animate-fade-in-up bg-light-card dark:bg-dark-card rounded-xl border border-light-border dark:border-dark-border overflow-hidden h-96 flex flex-col">
                        <div class="h-48 bg-gray-300 dark:bg-white/5 w-full animate-pulse"></div>
                        <div class="p-5 flex-1 flex flex-col gap-3 animate-pulse">
                            <div class="h-4 bg-gray-300 dark:bg-white/5 rounded w-1/4"></div>
                            <div class="h-6 bg-gray-300 dark:bg-white/5 rounded w-full"></div>
                            <div class="h-6 bg-gray-300 dark:bg-white/5 rounded w-2/3"></div>
                            <div class="mt-auto h-10 bg-gray-300 dark:bg-white/5 rounded w-full"></div>
                        </div>
                    </div>
                `).join('');
                this.els.emptyState.classList.add('hidden');
            },

            renderArticles(articles) {
                if (!articles || articles.length === 0) {
                    this.els.grid.innerHTML = '';
                    this.els.emptyState.classList.remove('hidden');
                    return;
                }
                
                this.els.emptyState.classList.add('hidden');
                
                this.els.grid.innerHTML = articles.map((article, index) => {
                    const fallbackImg = CONFIG.fallbackImages[index % CONFIG.fallbackImages.length];
                    // Clean description
                    const desc = article.description || article.content || "No description available for this story.";
                    // Identify language for badge (heuristic or API)
                    // If using Mock data, it's consistent. API returns 'source', but 'lang' might be inferred.
                    // We prefer State.language for consistency if not present.
                    const lang = article.lang || State.language;
                    const langLabel = lang === 'hi' ? 'Hindi' : lang === 'te' ? 'Telugu' : 'English';
                    
                    return `
                    <article style="animation-delay: ${index * 100}ms" class="animate-fade-in-up opacity-0 group relative flex flex-col h-full overflow-hidden rounded-2xl bg-black/80 backdrop-blur-2xl border border-brand-gold/30 shadow-lg shadow-black/20 hover:shadow-2xl hover:shadow-brand-gold/20 hover:border-brand-gold/80 hover:bg-black/90 transition-all duration-500 hover:scale-[1.02] hover:-translate-y-1">
                        
                        <!-- Shine/Sheen overlay effect -->
                        <div class="absolute inset-0 bg-gradient-to-tr from-transparent via-brand-gold/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"></div>

                        <div class="relative h-48 overflow-hidden bg-gray-900">
                            <img src="${article.image || fallbackImg}" 
                                 alt="${article.title}" 
                                 class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700 img-fade-in opacity-90 group-hover:opacity-100"
                                 onload="this.classList.add('img-loaded')"
                                 onerror="this.src='${fallbackImg}'">
                            <div class="absolute top-3 left-3">
                                <span class="px-2 py-1 text-xs font-bold bg-brand-gold text-black rounded-md shadow-lg shadow-brand-gold/20 uppercase tracking-wide border border-white/20">
                                    ${article.source.name}
                                </span>
                            </div>
                            <div class="absolute top-3 right-3">
                                <span class="px-2 py-1 text-xs font-medium bg-black/60 backdrop-blur-md text-brand-gold rounded-md border border-brand-gold/30 uppercase shadow-lg">
                                    ${langLabel}
                                </span>
                            </div>
                        </div>
                        
                        <div class="p-5 flex flex-col flex-1 relative z-10">
                            <div class="mb-2 flex items-center gap-2 text-xs text-brand-gold/80 font-medium tracking-wide">
                                <span>${new Date(article.publishedAt).toLocaleDateString()}</span>
                                <span>â€¢</span>
                                <span>News</span>
                            </div>
                            
                            <h3 class="text-lg font-bold mb-2 leading-tight text-white group-hover:text-brand-gold transition-colors drop-shadow-sm line-clamp-2">
                                ${article.title}
                            </h3>
                            
                            <p class="text-sm text-gray-300/90 line-clamp-3 mb-4 leading-relaxed font-normal">
                                ${desc}
                            </p>
                            
                            <div class="mt-auto flex items-center justify-between pt-4 border-t border-white/10 group-hover:border-brand-gold/30 transition-colors">
                                <a href="${article.url}" target="_blank" class="text-sm font-medium text-gray-400 hover:text-white transition-colors">
                                    Read Full Story
                                </a>
                                <button onclick="App.playArticle(${index})" 
                                        class="flex items-center gap-2 px-4 py-2 bg-brand-gold/10 hover:bg-brand-gold hover:text-black text-brand-gold border border-brand-gold/50 rounded-full text-sm font-semibold transition-all group/btn shadow-lg shadow-brand-gold/5">
                                    <i data-lucide="play-circle" class="w-4 h-4"></i>
                                    Listen
                                </button>
                            </div>
                        </div>
                    </article>
                `}).join('');
                
                this.initIcons();
            },

            updatePlayerState(isPlaying, isPaused, article) {
                // Visibility
                if (article) {
                    this.els.player.classList.remove('translate-y-[150%]');
                    this.els.playerTitle.textContent = article.title;
                    this.els.playerSource.textContent = `Reading from ${article.source.name}`;
                } else if (!isPlaying && !isPaused) {
                     // Auto hide after stop
                     setTimeout(() => {
                         if(!State.tts.speaking) this.els.player.classList.add('translate-y-[150%]');
                     }, 2000);
                }

                // Icons
                if (isPlaying && !isPaused) {
                    this.els.iconPlayPause.setAttribute('data-lucide', 'pause');
                    this.els.speakingRipple.classList.add('animate-ping');
                    this.els.speakingRipple.classList.remove('opacity-0');
                } else {
                    this.els.iconPlayPause.setAttribute('data-lucide', 'play');
                    this.els.speakingRipple.classList.remove('animate-ping');
                    this.els.speakingRipple.classList.add('opacity-0');
                }
                
                this.initIcons();
            },

            showBanner(msg, type = 'info') {
                this.els.statusText.textContent = msg;
                this.els.statusBanner.classList.remove('hidden');
                
                // Optional: color coding based on type if needed
            }
        };

        /**
         * MAIN APPLICATION LOGIC
         */
        const App = {
            init() {
                // Theme Setup
                this.setupTheme();
                
                // API / Data Load
                this.fetchNews();

                // TTS Init
                TTSEngine.init();

                // Event Listeners
                this.bindEvents();
                
                // Initial Render
                UI.renderCategories();
            },

            setupTheme() {
                const isDark = State.theme === 'dark' || 
                              (State.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
                
                if (isDark) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            },

            toggleTheme() {
                const isDark = document.documentElement.classList.toggle('dark');
                State.theme = isDark ? 'dark' : 'light';
                localStorage.setItem('theme', State.theme);
            },

            async fetchNews() {
                UI.renderSkeleton();
                State.isLoading = true;

                try {
                    // Check if the user has replaced the placeholder
                    if (CONFIG.apiKey === 'YOUR_API_KEY_HERE') {
                        throw new Error("MISSING_KEY");
                    }

                    let url;
                    
                    // Logic: If there is a search query, hit the 'search' endpoint.
                    // Otherwise, hit the 'top-headlines' endpoint for the current category.
                    // Include 'lang' and 'country' logic.
                    // For local news (Hindi/Telugu), prefer country 'in'. For 'en', default 'us'.
                    const countryParam = State.language === 'en' ? 'us' : 'in';

                    if (State.searchQuery && State.searchQuery.trim().length > 0) {
                        const q = encodeURIComponent(State.searchQuery.trim());
                        url = `https://gnews.io/api/v4/search?q=${q}&lang=${State.language}&country=${countryParam}&max=9&apikey=${CONFIG.apiKey}`;
                        UI.showBanner(`Searching for "${State.searchQuery}" (${State.language.toUpperCase()})...`);
                    } else {
                        const categoryParam = State.currentCategory.toLowerCase();
                        url = `https://gnews.io/api/v4/top-headlines?category=${categoryParam}&lang=${State.language}&country=${countryParam}&max=9&apikey=${CONFIG.apiKey}`;
                    }
                    
                    const res = await fetch(url);
                    
                    // Handle HTTP Errors
                    if (res.status === 403 || res.status === 401) throw new Error("INVALID_KEY");
                    if (res.status === 429) throw new Error("RATE_LIMIT");
                    if (!res.ok) throw new Error("NETWORK_ERROR");

                    const data = await res.json();
                    
                    if (!data.articles) throw new Error("BAD_FORMAT");

                    State.articles = data.articles;
                    
                    // Update banner based on context
                    if (State.searchQuery) {
                         UI.showBanner(`Found ${data.totalArticles || data.articles.length} results for "${State.searchQuery}"`);
                    } else {
                         UI.showBanner(`Live Feed: Global News Active (${State.language === 'hi' ? 'Hindi' : State.language === 'te' ? 'Telugu' : 'English'})`);
                    }

                } catch (error) {
                    let msg = '';
                    let useMock = true;

                    switch(error.message) {
                        case 'MISSING_KEY':
                            msg = 'Setup Required: Add your GNews API Key in the code to fetch live data.';
                            break;
                        case 'INVALID_KEY':
                            msg = 'API Error: Invalid Key. Switching to Backup Data.';
                            break;
                        case 'RATE_LIMIT':
                            msg = 'API Limit Reached. Switching to Backup Data.';
                            break;
                        case 'NETWORK_ERROR':
                            msg = 'Network Error. Switching to Offline Mode.';
                            break;
                        default:
                            msg = 'Offline Mode: Displaying Sample Data.';
                            console.warn("Fetch failed:", error);
                    }
                    
                    if (useMock) {
                        // Logic to serve mock data
                        let filtered = [...CONFIG.mockData];

                        // Mock Language Filter
                        filtered = filtered.filter(a => a.lang === State.language);
                        
                        // Intelligent Mock Search
                        if (State.searchQuery && State.searchQuery.trim().length > 0) {
                            const q = State.searchQuery.toLowerCase().trim();
                            filtered = filtered.filter(a => 
                                a.title.toLowerCase().includes(q) || 
                                (a.description && a.description.toLowerCase().includes(q))
                            );
                            msg = `Offline Mode: Showing sample results for "${State.searchQuery}"`;
                        } 
                        // Intelligent Mock Category
                        else if (State.currentCategory !== 'General') {
                            filtered = filtered.sort(() => 0.5 - Math.random());
                        }
                        
                        State.articles = filtered;
                    }
                    
                    UI.showBanner(msg);
                }
                
                this.filterAndRender(false); 
                State.isLoading = false;
            },

            filterAndRender(strictFilter = true) {
                let displayData = State.articles;

                if (strictFilter && State.searchQuery) {
                    const q = State.searchQuery.toLowerCase();
                    displayData = State.articles.filter(a => 
                        a.title.toLowerCase().includes(q) || 
                        (a.description && a.description.toLowerCase().includes(q))
                    );
                }

                UI.renderArticles(displayData);
            },

            switchCategory(cat) {
                if (State.currentCategory === cat) return;
                State.currentCategory = cat;
                
                State.searchQuery = '';
                UI.els.searchInput.value = '';
                if(UI.els.mobileSearchInput) UI.els.mobileSearchInput.value = '';
                
                UI.renderCategories(); 
                this.fetchNews(); 
            },

            switchLanguage(lang) {
                if (State.language === lang) return;
                State.language = lang;
                this.fetchNews();
            },

            toggleVoiceGender() {
                // Toggle State
                State.voiceGender = State.voiceGender === 'female' ? 'male' : 'female';
                
                // Update Icon
                if (UI.els.voiceIcon) {
                    UI.els.voiceIcon.textContent = State.voiceGender === 'female' ? 'ðŸ‘©' : 'ðŸ‘¨';
                }

                // If currently speaking, restart speech with new voice
                if (State.tts.speaking) {
                    // Find currently playing article index if possible, or just stop.
                    // For simplicity, we'll just stop current playback to apply setting.
                    // Ideally, we'd restart the current article, but we need the index.
                    // Let's just show a feedback banner.
                    UI.showBanner(`Voice changed to ${State.voiceGender === 'male' ? 'Male' : 'Female'}. Re-play to hear.`);
                    TTSEngine.stop();
                    UI.updatePlayerState(false, false, null);
                } else {
                    UI.showBanner(`Voice set to ${State.voiceGender === 'male' ? 'Male' : 'Female'}`);
                }
            },

            resetHome() {
                State.currentCategory = 'General';
                State.searchQuery = '';
                UI.els.searchInput.value = '';
                if(UI.els.mobileSearchInput) UI.els.mobileSearchInput.value = '';
                UI.renderCategories();
                this.fetchNews();
            },

            // TTS Controls
            playArticle(index) {
                const article = State.articles[index];
                if (!article) return;

                // Construct text to read
                const textToRead = `${article.title}. ${article.description || ''}.`;
                
                // Use selected language for TTS if article doesn't have explicit one (it should though)
                const lang = article.lang || State.language;

                TTSEngine.speak(
                    textToRead, 
                    lang,
                    State.voiceGender, // Pass gender preference
                    () => UI.updatePlayerState(true, false, article), // onStart
                    () => UI.updatePlayerState(false, false, null)    // onEnd
                );
            },

            togglePlayPause() {
                if (State.tts.speaking && !State.tts.paused) {
                    TTSEngine.pause();
                    UI.updatePlayerState(true, true, null); // Playing=true (active), Paused=true
                } else if (State.tts.paused) {
                    TTSEngine.resume();
                    UI.updatePlayerState(true, false, null);
                }
            },

            stopPlayer() {
                TTSEngine.stop();
                UI.updatePlayerState(false, false, null);
            },

            bindEvents() {
                // Search Debounce
                let timeout;
                const handleSearch = (e) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        const val = e.target.value;
                        if (State.searchQuery !== val) {
                            State.searchQuery = val;
                            this.fetchNews(); 
                        }
                    }, 800);
                };
                UI.els.searchInput.addEventListener('input', handleSearch);
                UI.els.mobileSearchInput.addEventListener('input', handleSearch);

                // Theme
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());

                // Player Controls
                UI.els.btnPlayPause.addEventListener('click', () => this.togglePlayPause());
                
                if (UI.els.btnStop) {
                    UI.els.btnStop.addEventListener('click', () => this.stopPlayer());
                }
                
                if (UI.els.btnClosePlayer) {
                    UI.els.btnClosePlayer.addEventListener('click', () => {
                        this.stopPlayer();
                        UI.els.player.classList.add('translate-y-full'); // Fixed: use standard hidden class logic or transform
                    });
                }
            }
        };

        // Start App
        window.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

    </script>
</body>
</html>